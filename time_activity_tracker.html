
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Time-based Private Activity Tracker</title>
<style>
  :root{--bg:#f4f6f8;--card:#ffffff;--muted:#6b7280;--accent:#ef4444;--good:#10b981}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;color:#0f172a;background:var(--bg)}
  .app{max-width:980px;margin:18px auto;padding:14px}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px}
  h1{font-size:20px;margin:0}
  .subtitle{color:var(--muted);font-size:13px}
  .grid{display:grid;grid-template-columns:1fr 420px;gap:14px}
  .card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.06);border:1px solid rgba(15,23,42,0.04)}
  label{display:block;color:var(--muted);font-size:13px;margin-bottom:6px}
  input[type="text"], select, button{padding:10px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);font-size:14px;width:100%;box-sizing:border-box;background:transparent}
  .row{display:flex;gap:8px;align-items:center}
  .btn{cursor:pointer;border:none;padding:10px 12px;border-radius:10px;font-weight:700}
  .btn.prim{background:linear-gradient(90deg,#10b981,#06b6d4);color:white}
  .btn.warn{background:#f59e0b;color:white}
  .btn.ghost{background:transparent;border:1px solid rgba(2,6,23,0.06)}
  .current{display:flex;flex-direction:column;gap:8px}
  .meta{display:flex;justify-content:space-between;align-items:center}
  .small{font-size:13px;color:var(--muted)}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{padding:8px;text-align:left;border-bottom:1px solid rgba(15,23,42,0.04);font-size:13px}
  .dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:8px;vertical-align:middle}
  .prod{background:var(--good)}
  .unprod{background:var(--accent)}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  .footer{margin-top:10px;color:var(--muted);font-size:13px}
  canvas{max-width:100%;height:auto;border-radius:8px;background:transparent}
  @media(max-width:920px){ .grid{grid-template-columns:1fr} }
</style>
</head>
<body>
<div class="app">
  <header>
    <div>
      <h1>Time-based Activity Tracker</h1>
      <div class="subtitle">Private — all data stored locally in your browser</div>
    </div>
    <div class="small">Today: <span id="todayLabel"></span></div>
  </header>

  <div class="grid">
    <div class="card">
      <div class="current">
        <label>Task title (optional)</label>
        <input id="taskTitle" type="text" placeholder="e.g., Study algorithms, Gym set, Deep work">
        <div class="meta">
          <div>
            <div class="small">Current task status</div>
            <div id="statusText"><strong>Stopped</strong></div>
          </div>
          <div style="text-align:right">
            <div class="small">Active time</div>
            <div id="activeTime" style="font-weight:700">00:00:00</div>
          </div>
        </div>

        <div class="controls">
          <button id="startBtn" class="btn prim">Start</button>
          <button id="pauseBtn" class="btn warn" style="display:none">Pause</button>
          <button id="resumeBtn" class="btn prim" style="display:none">Resume</button>
          <button id="endBtn" class="btn ghost" style="display:none">End</button>
        </div>

        <div class="small">When you click End you'll be asked to mark productive or not; the app saves the task with start/end time and duration.</div>
      </div>

      <div style="margin-top:12px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><b>Today's Tasks</b><div class="small">Tasks logged for the selected date</div></div>
          <div class="small">
            <label for="datePicker" class="small">Date:</label>
            <input id="datePicker" type="date">
          </div>
        </div>

        <div style="margin-top:8px;overflow:auto;max-height:320px">
          <table id="taskTable">
            <thead><tr><th>Title</th><th>Start</th><th>End</th><th>Duration</th><th>Status</th><th></th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="footer">
          <div id="dailySummary"></div>
          <div style="margin-top:6px" class="row">
            <button id="exportBtn" class="btn ghost">Export JSON</button>
            <label class="btn ghost" for="importFile">Import JSON</label>
            <input id="importFile" type="file" accept=".json" style="display:none"/>
            <button id="clearBtn" class="btn ghost">Clear All</button>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><b>Analytics</b><div class="small">Weekly and monthly productivity (productive hours)</div></div>
        <div class="row">
          <select id="rangeSelect" style="padding:8px;border-radius:8px;border:1px solid rgba(2,6,23,0.06)">
            <option value="7">Last 7 days</option>
            <option value="14">Last 14 days</option>
            <option value="30" selected>Last 30 days</option>
          </select>
          <button id="refreshCharts" class="btn ghost">Refresh</button>
        </div>
      </div>

      <div style="margin-top:12px">
        <canvas id="barChart" width="600" height="220"></canvas>
      </div>

      <div style="margin-top:12px">
        <b>Summary</b>
        <div class="small" id="summaryStats"></div>
      </div>
    </div>
  </div>
</div>

<script>
// Storage key
const LS_KEY = "timeActivityTracker_v1";

// Elements
const todayLabel = document.getElementById('todayLabel');
const taskTitle = document.getElementById('taskTitle');
const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const resumeBtn = document.getElementById('resumeBtn');
const endBtn = document.getElementById('endBtn');
const statusText = document.getElementById('statusText');
const activeTime = document.getElementById('activeTime');
const taskTableBody = document.querySelector('#taskTable tbody');
const datePicker = document.getElementById('datePicker');
const dailySummary = document.getElementById('dailySummary');
const exportBtn = document.getElementById('exportBtn');
const importFile = document.getElementById('importFile');
const clearBtn = document.getElementById('clearBtn');
const rangeSelect = document.getElementById('rangeSelect');
const refreshCharts = document.getElementById('refreshCharts');
const barChart = document.getElementById('barChart');
const summaryStats = document.getElementById('summaryStats');

// State
let data = loadData(); // array of entries: {id, title, startISO, endISO, durationMs, productive (bool)}
let current = null; // {id, title, start, paused, pausedAt, pausedDurationMs}

// Helpers
function saveData(){ localStorage.setItem(LS_KEY, JSON.stringify(data)); }
function loadData(){ try{ return JSON.parse(localStorage.getItem(LS_KEY)||'[]'); }catch(e){ return []; } }
function uid(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,6); }
function formatTime(iso){ if(!iso) return ""; const d=new Date(iso); return d.toLocaleString(); }
function msToHMS(ms){
  if(ms==null) return "00:00:00";
  ms = Math.max(0, Math.round(ms));
  const s = Math.floor(ms/1000);
  const hh = Math.floor(s/3600); const mm = Math.floor((s%3600)/60); const ss = s%60;
  return `${String(hh).padStart(2,'0')}:${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
}
function dateKeyFromISO(iso){ const d=new Date(iso); return d.getFullYear()+'-'+(d.getMonth()+1).toString().padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0'); }
function todayKey(){ const d=new Date(); return d.getFullYear()+'-'+(d.getMonth()+1).toString().padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0'); }

// Init
function init(){
  const now = new Date();
  todayLabel.textContent = now.toLocaleDateString();
  datePicker.value = todayKey();
  renderTasksForDate(datePicker.value);
  updateActiveTimerDisplay();
  drawCharts();
}

// Timer update
let timerInterval = null;
function updateActiveTimerDisplay(){
  if(current && current.start){
    const now = Date.now();
    let elapsed = now - current.start - (current.pausedDurationMs || 0);
    activeTime.textContent = msToHMS(elapsed);
  } else {
    activeTime.textContent = "00:00:00";
  }
}

// Start task
startBtn.addEventListener('click', ()=>{
  if(current){ alert("A task is already running. End or pause it first."); return; }
  const title = taskTitle.value.trim() || "Untitled task";
  current = { id: uid(), title, start: Date.now(), paused:false, pausedAt:null, pausedDurationMs:0 };
  statusText.innerHTML = `<strong>Running</strong> — ${title}`;
  startBtn.style.display='none'; pauseBtn.style.display='inline-block'; endBtn.style.display='inline-block';
  resumeBtn.style.display='none';
  // Start interval
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(()=> updateActiveTimerDisplay(), 500);
  updateActiveTimerDisplay();
});

// Pause
pauseBtn.addEventListener('click', ()=>{
  if(!current || current.paused) return;
  current.paused = true; current.pausedAt = Date.now();
  statusText.innerHTML = `<strong>Paused</strong> — ${current.title}`;
  pauseBtn.style.display='none'; resumeBtn.style.display='inline-block';
  if(timerInterval) clearInterval(timerInterval);
});

// Resume
resumeBtn.addEventListener('click', ()=>{
  if(!current || !current.paused) return;
  const now = Date.now();
  current.pausedDurationMs += (now - current.pausedAt);
  current.paused = false; current.pausedAt = null;
  statusText.innerHTML = `<strong>Running</strong> — ${current.title}`;
  resumeBtn.style.display='none'; pauseBtn.style.display='inline-block';
  // restart interval
  timerInterval = setInterval(()=> updateActiveTimerDisplay(), 500);
});

// End task
endBtn.addEventListener('click', ()=>{
  if(!current) return;
  // compute duration
  const end = Date.now();
  const duration = end - current.start - (current.pausedDurationMs || 0);
  // Ask productive or not
  const wasProductive = confirm("Mark this task as PRODUCTIVE? (OK = Productive, Cancel = Not productive)");
  // Save entry
  const entry = {
    id: current.id,
    title: current.title,
    startISO: new Date(current.start).toISOString(),
    endISO: new Date(end).toISOString(),
    durationMs: duration,
    productive: !!wasProductive
  };
  data.push(entry); saveData();
  // reset current
  current = null;
  statusText.innerHTML = `<strong>Stopped</strong>`;
  startBtn.style.display='inline-block'; pauseBtn.style.display='none'; resumeBtn.style.display='none'; endBtn.style.display='none';
  if(timerInterval) clearInterval(timerInterval);
  activeTime.textContent = "00:00:00";
  // refresh view
  renderTasksForDate(datePicker.value);
  drawCharts();
});

// Render tasks for selected date
function renderTasksForDate(dateKey){
  taskTableBody.innerHTML = "";
  const todays = data.filter(it => dateKeyFromISO(it.startISO) === dateKey).sort((a,b)=> new Date(b.startISO)-new Date(a.startISO));
  for(const it of todays){
    const tr = document.createElement('tr');
    const dur = msToHMS(it.durationMs);
    tr.innerHTML = `
      <td>${escapeHtml(it.title)}</td>
      <td>${formatTime(it.startISO)}</td>
      <td>${formatTime(it.endISO)}</td>
      <td>${dur}</td>
      <td>${it.productive ? '<span class="dot prod"></span><span class="small">Productive</span>' : '<span class="dot unprod"></span><span class="small">Not productive</span>'}</td>
      <td><button onclick="deleteEntry('${it.id}')">Delete</button></td>
    `;
    taskTableBody.appendChild(tr);
  }
  // summary
  const totalMs = todays.reduce((s,x)=> s + (x.durationMs||0), 0);
  const prodMs = todays.filter(x=>x.productive).reduce((s,x)=> s + (x.durationMs||0), 0);
  dailySummary.innerHTML = `<strong>Today's totals:</strong> ${msToHMS(prodMs)} productive • ${msToHMS(totalMs - prodMs)} unproductive • <span style="font-weight:700">${msToHMS(totalMs)}</span> total`;
  // update export/import controls availability
}

// Delete entry
function deleteEntry(id){
  if(!confirm("Delete this entry?")) return;
  data = data.filter(x=>x.id!==id); saveData();
  renderTasksForDate(datePicker.value);
  drawCharts();
}

// Date picker change
datePicker.addEventListener('change', ()=> renderTasksForDate(datePicker.value));

// Export/Import/Clear
exportBtn.addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='time-activity-backup.json';
  document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=> URL.revokeObjectURL(url), 3000);
});

importFile.addEventListener('change', (e)=>{
  const f = e.target.files[0]; if(!f) return;
  const reader = new FileReader(); reader.onload = ()=>{
    try{
      const parsed = JSON.parse(reader.result);
      if(!Array.isArray(parsed)) throw new Error("Invalid format");
      // merge safely
      const existingIds = new Set(data.map(x=>x.id));
      const toAdd = parsed.map(x=>{
        if(!x.id) x.id = uid();
        while(existingIds.has(x.id)) x.id = uid();
        existingIds.add(x.id);
        return x;
      });
      data = data.concat(toAdd);
      saveData();
      alert("Imported "+toAdd.length+" items.");
      renderTasksForDate(datePicker.value);
      drawCharts();
    }catch(err){ alert("Import failed: "+err.message); }
    importFile.value = "";
  };
  reader.readAsText(f);
});

clearBtn.addEventListener('click', ()=>{
  if(confirm("Clear ALL saved entries? This cannot be undone.")){
    data = []; saveData();
    renderTasksForDate(datePicker.value);
    drawCharts();
  }
});

// Charts drawing (simple bar chart of productive hours per day)
function drawCharts(){
  const days = parseInt(rangeSelect.value || "30", 10);
  const end = new Date(); end.setHours(23,59,59,999);
  const start = new Date(end); start.setDate(end.getDate() - (days-1)); start.setHours(0,0,0,0);
  // Build day labels and sums
  const labels = []; const prodHours = []; const totalHours = [];
  for(let i=0;i<days;i++){
    const d = new Date(start); d.setDate(start.getDate()+i);
    const key = d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0');
    labels.push((d.getMonth()+1)+'/'+d.getDate());
    // sum durations for this day
    const dayEntries = data.filter(it=> dateKeyFromISO(it.startISO) === key);
    const prodMs = dayEntries.filter(x=>x.productive).reduce((s,x)=> s + (x.durationMs||0), 0);
    const totMs = dayEntries.reduce((s,x)=> s + (x.durationMs||0), 0);
    prodHours.push(Number((prodMs/3600000).toFixed(2))); // hours with 2 decimals
    totalHours.push(Number((totMs/3600000).toFixed(2)));
  }
  // draw on canvas
  const ctx = barChart.getContext('2d');
  const W = barChart.width = barChart.clientWidth * devicePixelRatio;
  const H = barChart.height = 220 * devicePixelRatio;
  ctx.clearRect(0,0,W,H);
  // margins
  const pad = 36 * devicePixelRatio;
  const innerW = W - pad*2;
  const innerH = H - pad*2;
  // scale
  const maxVal = Math.max(...totalHours, 1);
  // draw axes
  ctx.strokeStyle = "rgba(0,0,0,0.08)";
  ctx.lineWidth = 1 * devicePixelRatio;
  ctx.beginPath(); ctx.moveTo(pad, pad); ctx.lineTo(pad, pad+innerH); ctx.lineTo(pad+innerW, pad+innerH); ctx.stroke(); ctx.closePath();
  // bars: for each day draw two stacked bars (productive green portion, unproductive red portion)
  const barW = innerW / labels.length * 0.6;
  for(let i=0;i<labels.length;i++){
    const x = pad + (i + 0.5) * (innerW/labels.length);
    const total = totalHours[i];
    const prod = prodHours[i];
    const scale = innerH / (maxVal || 1);
    const prodH = prod * scale;
    const totH = total * scale;
    // unproductive part height
    const unH = Math.max(0, totH - prodH);
    // draw productive (green) - bottom part
    ctx.fillStyle = "#10b981";
    ctx.fillRect(x - barW/2, pad + innerH - prodH, barW, prodH);
    // draw unproductive (red) stacked above the productive
    if(unH > 0){
      ctx.fillStyle = "#ef4444";
      ctx.fillRect(x - barW/2, pad + innerH - prodH - unH, barW, unH);
    }
    // draw label
    ctx.fillStyle = "#374151";
    ctx.font = `${11 * devicePixelRatio}px sans-serif`;
    ctx.textAlign = "center";
    ctx.fillText(labels[i], x, pad + innerH + (14 * devicePixelRatio));
  }
  // summary stats
  const totalSumHours = totalHours.reduce((s,x)=>s+x,0).toFixed(2);
  const prodSumHours = prodHours.reduce((s,x)=>s+x,0).toFixed(2);
  summaryStats.innerHTML = `Productive: <strong>${prodSumHours} h</strong> • Total: <strong>${totalSumHours} h</strong> over last ${labels.length} days`;
}

// Refresh charts button
refreshCharts.addEventListener('click', drawCharts);
rangeSelect.addEventListener('change', drawCharts);

// small helper
function escapeHtml(s){ if(!s) return ''; return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

// Delete entry exposed for inline onclick
window.deleteEntry = deleteEntry;

// Periodically update active time display if a task is running
setInterval(()=> updateActiveTimerDisplay(), 500);

// init app
init();

</script>
</body>
</html>
